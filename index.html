<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumi's Watercolor Orchard</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&family=Noto+Sans+TC:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-watercolor: #fdfaf5;
            --text-color: #5a5a5a;
            --sign-wood: #8d6e63;
        }

        /* 景氣燈號色彩連動 */
        body.light-藍燈 { --bg-watercolor: #eef7ff; }
        body.light-黃藍燈 { --bg-watercolor: #f0fbff; }
        body.light-綠燈 { --bg-watercolor: #f7fbf2; }
        body.light-黃紅燈 { --bg-watercolor: #fff9f0; }
        body.light-紅燈 { --bg-watercolor: #fff5f5; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-watercolor);
            background-image: url('https://www.transparenttextures.com/patterns/handmade-paper.png');
            color: var(--text-color);
            margin: 0; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            transition: background-color 2s ease;
            visibility: hidden;
        }

        .container { width: 95%; max-width: 900px; text-align: center; }

        h1 {
            font-family: 'ZCOOL XiaoWei', serif;
            font-size: 3.5rem; margin: 0; letter-spacing: 12px;
            color: #3e4a42; text-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }

        /* --- 景觀生態區 --- */
        .ecosystem {
            display: flex; align-items: flex-end; height: 400px;
            margin: 30px 0; position: relative;
            background: rgba(255,255,255,0.2); border-radius: 100px 100px 20px 20px;
        }

        /* --- 噴水池 --- */
        .fountain-area { width: 180px; text-align: center; padding-bottom: 20px; }
        .fountain-base {
            width: 140px; height: 45px; background: #e0e0e0;
            border-radius: 50%; margin: 0 auto; border: 4px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .water-column {
            width: 6px; background: rgba(162, 210, 255, 0.7);
            margin: 0 auto; border-radius: 10px;
            transition: height 2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        .water-crown {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 20px; background: rgba(202, 240, 248, 0.5);
            border-radius: 50%; filter: blur(5px); animation: splash 1.5s infinite;
        }
        @keyframes splash { 0%, 100% { transform: translate(-50%, 0) scale(1); } 50% { transform: translate(-50%, -15px) scale(1.3); } }

        /* --- 隨機森林畫布 --- */
        .orchard-canvas { flex-grow: 1; height: 100%; position: relative; overflow: hidden; }
        .tree-container { position: absolute; transition: all 1s ease; cursor: help; }
        
        .stock-tag {
            background: rgba(255,255,255,0.85); padding: 5px 10px;
            border-radius: 12px; font-size: 12px; border: 1px solid #eee;
            box-shadow: 0 4px 6px rgba(0,0,0,0.03); white-space: nowrap;
        }
        .fertilize-alert { color: #e63946; font-weight: bold; margin-left: 5px; animation: glow 1s infinite alternate; }
        @keyframes glow { from { opacity: 0.4; } to { opacity: 1; } }

        /* --- 森林告示牌 --- */
        .signpost {
            background: var(--sign-wood); color: #fff;
            padding: 15px 40px; border-radius: 4px; border: 2px solid #fff;
            box-shadow: 0 8px 0 #5d4037, 0 15px 20px rgba(0,0,0,0.1);
            position: relative; display: inline-block; margin-top: 20px;
            font-size: 1.1rem; line-height: 1.6;
        }
        .signpost::before { content: "||"; position: absolute; top: 100%; left: 20%; color: #5d4037; font-weight: bold; }
        .signpost::after { content: "||"; position: absolute; top: 100%; right: 20%; color: #5d4037; font-weight: bold; }

    </style>
</head>
<body>

<div class="container">
    <h1 id="main-title">Lumi 成長森林</h1>
    <p id="progress-info" style="font-size: 14px; opacity: 0.6;">正在與大地連線...</p>

    <div class="ecosystem">
        <div class="fountain-area">
            <div id="fountain-stream" class="water-column" style="height: 20px;">
                <div class="water-crown"></div>
            </div>
            <div class="fountain-base"></div>
            <p style="font-size: 11px; margin-top: 8px;">銀行餘額噴泉</p>
        </div>

        <div class="orchard-canvas" id="orchard-canvas"></div>
    </div>

    <div class="signpost" id="daily-guide">讀取森林指引中...</div>
</div>

<script>
    const MY_PASSWORD = "lumi2026"; 
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQAnKIlc9Lf9PxSlb83nV1Wny7fC0EhKpy9iR41mMRqnLDepRpWwz8qyiIWaDEjY0TWaGLROfzeKbHG/pub?gid=768557640&single=true&output=csv"; 

    // 果樹插畫資源 (SVG)
    const fruitTrees = {
        apple: `<svg viewBox="0 0 100 100"><circle cx="50" cy="40" r="30" fill="#a8d5ba"/><circle cx="40" cy="30" r="4" fill="#ff4d4d"/><circle cx="60" cy="45" r="4" fill="#ff4d4d"/><rect x="46" y="70" width="8" height="20" fill="#795548"/></svg>`,
        orange: `<svg viewBox="0 0 100 100"><circle cx="50" cy="40" r="30" fill="#cdeac0"/><circle cx="45" cy="45" r="5" fill="#ffa500"/><circle cx="65" cy="35" r="5" fill="#ffa500"/><rect x="46" y="70" width="8" height="20" fill="#795548"/></svg>`,
        peach: `<svg viewBox="0 0 100 100"><circle cx="50" cy="40" r="32" fill="#ffcad4"/><circle cx="45" cy="40" r="4" fill="#ff8fab"/><rect x="47" y="72" width="6" height="18" fill="#5d4037"/></svg>`,
        default: `<svg viewBox="0 0 100 100"><circle cx="50" cy="40" r="28" fill="#d8e2dc"/><rect x="47" y="68" width="6" height="22" fill="#8d6e63"/></svg>`
    };

    function start() {
        const pass = prompt("請輸入通往森林的密碼：");
        if (pass === MY_PASSWORD) { document.body.style.visibility = "visible"; load(); }
        else { window.location.reload(); }
    }

    async function load() {
        try {
            const resp = await fetch(csvUrl + "&t=" + Date.now());
            const text = await resp.text();
            const rows = text.split(/\r?\n/).map(r => r.split(',').map(c => c.replace(/["]+/g, '').trim()));
            
            const num = (v) => parseFloat(String(v).replace(/[^\d.-]/g, '')) || 0;
            const data = {
                assets: num(rows[0][1]), goal: num(rows[1][1]),
                cash: num(rows[2][1]), monthly: num(rows[3][1]),
                advice: rows[4][1], light: rows[5][1], stocks: []
            };

            for(let i=6; i<rows.length; i++) {
                if(rows[i][0]) data.stocks.push({ name: rows[i][0], val: num(rows[i][1]), alert: rows[i][2], type: rows[i][3] });
            }
            render(data);
        } catch(e) { console.error(e); }
    }

    function render(d) {
        document.body.className = `light-${d.light}`;
        document.getElementById('daily-guide').innerText = d.advice;
        document.getElementById('progress-info').innerText = `目前進度：${((d.assets/d.goal)*100).toFixed(1)}% ｜ 森林總價值：${d.assets.toLocaleString()} 元`;

        // 更新噴水池
        const height = Math.min((d.cash / (d.monthly * 3)) * 250, 300);
        document.getElementById('fountain-stream').style.height = height + "px";

        // 繪製隨機森林
        const canvas = document.getElementById('orchard-canvas');
        canvas.innerHTML = '';
        d.stocks.forEach((s, i) => {
            const div = document.createElement('div');
            div.className = 'tree-container';
            div.style.left = (10 + (Math.random() * 70)) + '%';
            div.style.bottom = (5 + (Math.random() * 15)) + '%';
            
            const size = 70 + (s.val / d.assets) * 200;
            div.innerHTML = `
                <div style="width:${size}px; height:${size}px;">${fruitTrees[s.type] || fruitTrees.default}</div>
                <div class="stock-tag">${s.name}: ${s.val.toLocaleString()} ${s.alert ? '<span class="fertilize-alert">✨需施肥</span>' : ''}</div>
            `;
            canvas.appendChild(div);
        });
    }
    start();
</script>
</body>
</html>
